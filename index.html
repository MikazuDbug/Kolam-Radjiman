<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Prometheus Command Interface</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(-45deg, #0f0c29, #302b63, #24243e);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            -webkit-tap-highlight-color: transparent;
        }
        @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        .stat-card { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); transition: all 0.3s ease; }
        .stat-card:hover { transform: translateY(-5px); box-shadow: 0 10px 30px rgba(0,0,0,0.2); border-color: rgba(0, 255, 255, 0.3); }
        .live-dot { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .value-update { animation: value-flash 0.7s ease; }
        @keyframes value-flash { 0% { color: #00ffff; transform: scale(1.1); } 100% { color: white; transform: scale(1.0); } }
    </style>
</head>
<body class="text-white">

    <div id="loader" class="min-h-screen flex flex-col items-center justify-center transition-opacity duration-500">
        <svg class="animate-spin h-10 w-10 text-cyan-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        <h1 id="loader-text" class="text-xl font-bold mt-4">Connecting to Prometheus Core...</h1>
    </div>

    <main id="dashboard" class="container mx-auto p-4 md:p-8 opacity-0 hidden transition-opacity duration-500">
        <header class="flex justify-between items-center mb-8">
            <div>
                <h1 class="text-2xl md:text-3xl font-black uppercase tracking-widest">Prometheus</h1>
                <p class="text-gray-400 text-sm">Radjiman Command Interface</p>
            </div>
            <div class="flex items-center space-x-2 border border-gray-700 bg-gray-800/50 px-3 py-1 rounded-full">
                <div id="status-dot" class="w-3 h-3 rounded-full bg-red-500"></div>
                <span id="status-text" class="text-sm font-semibold">OFFLINE</span>
            </div>
        </header>

        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6">
            <div class="stat-card p-4 rounded-lg">
                <h3 class="text-sm font-semibold text-gray-400">Pendapatan Hari Ini</h3>
                <p id="today-revenue" class="text-2xl md:text-4xl font-bold mt-2">Rp 0</p>
            </div>
            <div class="stat-card p-4 rounded-lg">
                <h3 class="text-sm font-semibold text-gray-400">Pengunjung Hari Ini</h3>
                <p id="today-visitors" class="text-2xl md:text-4xl font-bold mt-2">0</p>
            </div>
            <div class="stat-card p-4 rounded-lg col-span-2">
                <h3 class="text-sm font-semibold text-gray-400">Anggaran Pengeluaran Bulan Ini</h3>
                <div class="w-full bg-gray-700 rounded-full h-2.5 mt-3"><div id="budget-bar" class="bg-gradient-to-r from-cyan-400 to-blue-500 h-2.5 rounded-full" style="width: 0%"></div></div>
                <p id="budget-text" class="text-right text-xs mt-1 font-mono">Rp 0 / Rp 0</p>
            </div>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mt-6">
            <div class="lg:col-span-2 stat-card p-6 rounded-lg">
                <h3 class="font-bold text-lg mb-4 text-cyan-300">Live Audit Trail</h3>
                <div id="audit-log" class="space-y-3 h-64 overflow-y-auto pr-2 text-xs md:text-sm font-mono"></div>
            </div>
            <div class="stat-card p-6 rounded-lg">
                <h3 class="font-bold text-lg mb-4 text-cyan-300">Ringkasan Total</h3>
                <div class="space-y-4">
                    <div><p class="text-gray-400 text-sm">Total Tiket Terjual</p><p id="lifetime-visitors" class="text-2xl font-bold">0</p></div>
                    <div><p class="text-gray-400 text-sm">Total Pendapatan</p><p id="lifetime-revenue" class="text-2xl font-bold">Rp 0</p></div>
                </div>
            </div>
        </div>
    </main>

    <script>
        const loader = document.getElementById('loader');
        const loaderText = document.getElementById('loader-text');
        const dashboard = document.getElementById('dashboard');
        const statusDot = document.getElementById('status-dot');
        const statusText = document.getElementById('status-text');

        const todayRevenueEl = document.getElementById('today-revenue');
        const todayVisitorsEl = document.getElementById('today-visitors');
        const lifetimeRevenueEl = document.getElementById('lifetime-revenue');
        const lifetimeVisitorsEl = document.getElementById('lifetime-visitors');
        const budgetBarEl = document.getElementById('budget-bar');
        const budgetTextEl = document.getElementById('budget-text');
        const auditLogEl = document.getElementById('audit-log');

        function animateValue(element) { element.classList.add('value-update'); setTimeout(() => element.classList.remove('value-update'), 700); }
        function addLog(message, type = 'INFO') { const colors = { INFO: 'text-cyan-400', SUCCESS: 'text-green-400', WARN: 'text-yellow-400', DANGER: 'text-red-400' }; const logEntry = document.createElement('div'); const time = new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit', second: '2-digit'}); logEntry.innerHTML = `<span class="${colors[type]}">[${time}]</span> <span class="text-gray-300">${message}</span>`; auditLogEl.prepend(logEntry); if (auditLogEl.children.length > 20) { auditLogEl.lastChild.remove(); } }
        function updateUI(data) { if (!data) return; const formatCurrency = (num) => `Rp ${num.toLocaleString('id-ID')}`; const formatNumber = (num) => num.toLocaleString('id-ID'); if (todayRevenueEl.textContent !== formatCurrency(data.today.revenue)) animateValue(todayRevenueEl); todayRevenueEl.textContent = formatCurrency(data.today.revenue); if (todayVisitorsEl.textContent !== formatNumber(data.today.count)) animateValue(todayVisitorsEl); todayVisitorsEl.textContent = formatNumber(data.today.count); lifetimeRevenueEl.textContent = formatCurrency(data.lifetime.revenue); lifetimeVisitorsEl.textContent = formatNumber(data.lifetime.visitors); const budget = data.budget.monthly; const spent = data.budget.spent; const percentage = budget > 0 ? (spent / budget) * 100 : 0; budgetBarEl.style.width = `${Math.min(percentage, 100)}%`; budgetTextEl.textContent = `${formatCurrency(spent)} / ${formatCurrency(budget)}`; }
        function connect() { const protocol = window.location.protocol === 'https:' ? 'wss' : 'ws'; const wsUrl = `${protocol}://${window.location.host}`; const ws = new WebSocket(wsUrl);
            ws.onopen = () => { console.log('Connected to Prometheus Core'); statusDot.classList.remove('bg-red-500'); statusDot.classList.add('bg-green-400', 'live-dot'); statusText.textContent = 'REAL-TIME'; addLog('Koneksi ke Prometheus Core berhasil.', 'SUCCESS'); };
            ws.onmessage = (event) => { const data = JSON.parse(event.data); if (data.type === 'initial' || data.type === 'update') { if (loader.style.opacity !== '0') { loader.style.opacity = '0'; setTimeout(() => { loader.style.display = 'none'; dashboard.style.display = 'block'; dashboard.style.opacity = '1'; }, 500); } updateUI(data.payload); if(data.log) addLog(data.log); } };
            ws.onclose = () => { console.log('Disconnected. Reconnecting in 3 seconds...'); statusDot.classList.add('bg-red-500'); statusDot.classList.remove('bg-green-400', 'live-dot'); statusText.textContent = 'OFFLINE'; loaderText.textContent = 'Koneksi Terputus, Mencoba lagi...'; addLog('Koneksi terputus. Menyambungkan ulang...', 'DANGER'); setTimeout(connect, 3000); };
            ws.onerror = (error) => { console.error('WebSocket Error:', error); ws.close(); };
        }
        connect();
    </script>
</body>
</html>